<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abby's Legendary Pizza - Locations</title>
    <style>
        /* Mobile-First CSS Variables */
        :root {
            --primary-red: #d12027;
            --primary-green: #00703c;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-main: #333333;
            --text-light: #666666;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            padding-top: 80px; /* Space for sticky header */
        }

        /* Sticky Header */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: var(--card-bg);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            z-index: 1000;
        }

        .logo-img {
            max-height: 45px;
            width: auto;
            display: block;
        }

        .find-btn {
            background-color: var(--primary-green);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.2s;
        }

        .find-btn:hover {
            background-color: #00592e;
        }

        /* Store List Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Search Bar Styling */
        .search-container {
            margin-bottom: 20px;
        }

        #searchInput {
            width: 100%;
            padding: 14px 20px;
            font-size: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        #searchInput:focus {
            border-color: var(--primary-red);
            box-shadow: 0 0 0 3px rgba(209, 32, 39, 0.1);
        }

        .status-message {
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
            color: var(--primary-red);
        }

        .store-grid {
            display: grid;
            grid-template-columns: 1fr; /* Mobile first: 1 column */
            gap: 20px;
        }

        /* Responsive Grid for Tablets and Desktop */
        @media (min-width: 600px) {
            .store-grid { grid-template-columns: repeat(2, 1fr); }
        }
        @media (min-width: 900px) {
            .store-grid { grid-template-columns: repeat(3, 1fr); }
        }

        /* Store Card Styling */
        .store-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border-top: 5px solid var(--primary-red);
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .store-card.closest {
            border-top: 5px solid var(--primary-green);
            background-color: #f0fdf4;
            transform: scale(1.02);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }

        .store-name {
            font-size: 1.25rem;
            margin-bottom: 10px;
            color: var(--text-main);
        }

        .closest-badge {
            display: inline-block;
            background-color: var(--primary-green);
            color: white;
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 12px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .store-address, .store-phone, .store-hours {
            color: var(--text-light);
            margin-bottom: 5px;
            font-size: 0.95rem;
            line-height: 1.4;
        }
        
        /* Clean formatting for the phone link */
        .store-phone a {
            color: var(--text-light);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .store-phone a:hover {
            color: var(--primary-red);
            text-decoration: underline;
        }

        .distance {
            font-weight: bold;
            color: var(--primary-green);
            margin-top: 10px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            flex: 1;
            text-align: center;
            padding: 10px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            font-size: 0.9rem;
            transition: opacity 0.2s;
        }

        .btn:hover { opacity: 0.9; }

        .btn-order {
            background-color: var(--primary-red);
            color: white;
        }

        .btn-directions {
            background-color: #e2e8f0;
            color: var(--text-main);
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>

    <header>
        <a href="#">
            <img src="Abby's Logo Red.png" alt="Abby's Pizza Logo" class="logo-img">
        </a>
        <button class="find-btn" id="locateBtn">üìç Find Nearest</button>
    </header>

    <main class="container">
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Search Store details: city, street, or zip code...">
        </div>
        
        <div id="statusMessage" class="status-message"></div>
        <div class="store-grid" id="storeGrid">
            </div>
    </main>

    <script>
        // Store Data Array with exact ordering URLs and placeholder hours
        const stores = [
            { name: "Albany", address: "3033 Santiam Hwy SE, Albany, OR 97322", phone: "(541) 928-9311", hours: "11:00 AM - 10:00 PM (Daily)", lat: 44.6263, lng: -123.0645, orderUrl: "https://albany.abbys.com" },
            { name: "Bend", address: "1115 NE 3rd St, Bend, OR 97701", phone: "(541) 382-7372", hours: "11:00 AM - 10:00 PM (Daily)", lat: 44.0652, lng: -121.3056, orderUrl: "https://bend.abbys.com" },
            { name: "Central Point", address: "825 E Pine St, Central Point, OR 97502", phone: "(541) 664-1124", hours: "11:00 AM - 10:00 PM (Daily)", lat: 42.3761, lng: -122.9103, orderUrl: "https://centralpoint.abbys.com" },
            { name: "Coos Bay", address: "997 S 1st St, Coos Bay, OR 97420", phone: "(541) 267-5839", hours: "11:00 AM - 10:00 PM (Daily)", lat: 43.3665, lng: -124.2154, orderUrl: "https://coosbay.abbys.com" },
            { name: "Dallas", address: "174 W Ellendale Ave, Dallas, OR 97338", phone: "(503) 623-2222", hours: "11:00 AM - 10:00 PM (Daily)", lat: 44.9221, lng: -123.3182, orderUrl: "https://dallas.abbys.com" },
            { name: "Eagle Point", address: "11200 Oregon 62, Eagle Point, OR 97524", phone: "(541) 826-7007", hours: "11:00 AM - 10:00 PM (Daily)", lat: 42.4721, lng: -122.8021, orderUrl: "https://eaglepoint.abbys.com" },
            { name: "Eugene - Echo Hollow Rd", address: "1976 Echo Hollow Rd, Eugene, OR 97402", phone: "(541) 689-2229", hours: "11:00 AM - 10:00 PM (Daily)", lat: 44.0691, lng: -123.1672, orderUrl: "https://echohollow.abbys.com" },
            { name: "Eugene - River Rd", address: "1970 River Rd, Eugene, OR 97404", phone: "(541) 689-0091", hours: "11:00 AM - 10:00 PM (Daily)", lat: 44.0864, lng: -123.1251, orderUrl: "https://riverroad.abbys.com" },
            { name: "Florence", address: "1374 Hwy 101, Florence, OR 97439", phone: "(541) 997-6608", hours: "11:00 AM - 10:00 PM (Daily)", lat: 43.9723, lng: -124.1001, orderUrl: "https://florence.abbys.com" },
            { name: "Grants Pass - Beacon Drive", address: "205 NE Beacon Dr, Grants Pass, OR 97526", phone: "(541) 476-2133", hours: "11:00 AM - 10:00 PM (Daily)", lat: 42.4501, lng: -123.3142, orderUrl: "https://beacon.abbys.com" },
            { name: "Grants Pass - Williams Highway", address: "1560 Williams Hwy, Grants Pass, OR 97527", phone: "(541) 479-9695", hours: "11:00 AM - 10:00 PM (Daily)", lat: 42.4201, lng: -123.3361, orderUrl: "https://williams.abbys.com" },
            { name: "Gresham", address: "21255 SE Stark St, Gresham, OR 97030", phone: "(503) 465-6600", hours: "11:00 AM - 10:00 PM (Daily)", lat: 45.5192, lng: -122.4431, orderUrl: "https://gresham.abbys.com" },
            { name: "Junction City", address: "1425 Ivy St, Junction City, OR 97448", phone: "(541) 998-6500", hours: "11:00 AM - 10:00 PM (Daily)", lat: 44.2281, lng: -123.2042, orderUrl: "https://junctioncity.abbys.com" },
            { name: "Keizer", address: "3451 River Rd N, Keizer, OR 97303", phone: "(503) 390-2088", hours: "11:00 AM - 10:00 PM (Daily)", lat: 44.9812, lng: -123.0321, orderUrl: "https://keizer.abbys.com" },
            { name: "Klamath Falls - Shallock Ave", address: "2226 Shallock Ave, Klamath Falls, OR 97601", phone: "(541) 882-2177", hours: "11:00 AM - 10:00 PM (Daily)", lat: 42.2381, lng: -121.7821, orderUrl: "https://campus.abbys.com" },
            { name: "Klamath Falls - Shasta Plaza", address: "1919 Austin St, Klamath Falls, OR 97603", phone: "(541) 884-2444", hours: "11:00 AM - 10:00 PM (Daily)", lat: 42.2081, lng: -121.7612, orderUrl: "https://shasta.abbys.com" },
            { name: "Madras", address: "1235 U.S. 97, Madras, OR 97741", phone: "(541) 475-6363", hours: "11:00 AM - 10:00 PM (Daily)", lat: 44.6221, lng: -121.1291, orderUrl: "https://madras.abbys.com" },
            { name: "Medford - North", address: "2550 Crater Lake Hwy, Medford, OR 97504", phone: "(541) 776-2022", hours: "11:00 AM - 10:00 PM (Daily)", lat: 42.3481, lng: -122.8631, orderUrl: "https://northmedford.abbys.com" },
            { name: "Medford - South", address: "1080 S Riverside Ave, Medford, OR 97501", phone: "(541) 773-5568", hours: "11:00 AM - 10:00 PM (Daily)", lat: 42.3161, lng: -122.8641, orderUrl: "https://medford.abbys.com" },
            { name: "Myrtle Creek", address: "700 S Main St, Myrtle Creek, OR 97457", phone: "(541) 863-4000", hours: "11:00 AM - 10:00 PM (Daily)", lat: 43.0181, lng: -123.2952, orderUrl: "https://myrtlecreek.abbys.com" },
            { name: "Newberg", address: "1913 Portland Road, Newberg, OR 97132", phone: "(503) 538-3800", hours: "11:00 AM - 10:00 PM (Daily)", lat: 45.3111, lng: -122.9561, orderUrl: "https://newberg.abbys.com" },
            { name: "Newport", address: "932 NW Coast Hwy, Newport, OR 97365", phone: "(541) 265-9336", hours: "11:00 AM - 10:00 PM (Daily)", lat: 44.6432, lng: -124.0551, orderUrl: "https://newport.abbys.com" },
            { name: "Oregon City", address: "19011 Beavercreek Road, Oregon City, OR 97045", phone: "(503) 387-6129", hours: "11:00 AM - 10:00 PM (Daily)", lat: 45.3341, lng: -122.5801, orderUrl: "https://oregoncity.abbys.com" },
            { name: "Pendleton", address: "828 Southgate, Pendleton, OR 97801", phone: "(541) 278-2229", hours: "11:00 AM - 10:00 PM (Daily)", lat: 45.6591, lng: -118.8021, orderUrl: "https://pendleton.abbys.com" },
            { name: "Prineville", address: "1485 NE 3rd St, Prineville, OR 97754", phone: "(541) 903-9500", hours: "11:00 AM - 10:00 PM (Daily)", lat: 44.3031, lng: -120.8351, orderUrl: "https://prineville.abbys.com" },
            { name: "Redmond", address: "1938 U.S. 97, Redmond, OR 97756", phone: "(541) 548-5266", hours: "11:00 AM - 10:00 PM (Daily)", lat: 44.2561, lng: -121.1732, orderUrl: "https://redmond.abbys.com" },
            { name: "Rogue River", address: "121 Pine St, Rogue River, OR 97537", phone: "(541) 582-4203", hours: "11:00 AM - 10:00 PM (Daily)", lat: 42.4331, lng: -123.1721, orderUrl: "https://rogueriver.abbys.com" },
            { name: "Roseburg - Diamond Lake Blvd.", address: "2585 NE Diamond Lake Blvd, Roseburg, OR 97470", phone: "(541) 672-7781", hours: "11:00 AM - 10:00 PM (Daily)", lat: 43.2181, lng: -123.3221, orderUrl: "https://diamond.abbys.com" },
            { name: "Roseburg - Stephens Street", address: "1661 NE Stephens St, Roseburg, OR 97470", phone: "(541) 672-2646", hours: "11:00 AM - 10:00 PM (Daily)", lat: 43.2281, lng: -123.3441, orderUrl: "https://stephens.abbys.com" },
            { name: "Springfield", address: "2053 Olympic St, Springfield, OR 97477", phone: "(541) 747-4444", hours: "11:00 AM - 10:00 PM (Daily)", lat: 44.0561, lng: -122.9861, orderUrl: "https://springfield.abbys.com" },
            { name: "Sutherlin", address: "1011 W Central Ave, Sutherlin, OR 97479", phone: "(541) 459-9595", hours: "11:00 AM - 10:00 PM (Daily)", lat: 43.3881, lng: -123.3321, orderUrl: "https://sutherlin.abbys.com" },
            { name: "Winston", address: "96 S.W. Douglas, Winston, OR 97496", phone: "(541) 679-6555", hours: "11:00 AM - 10:00 PM (Daily)", lat: 43.1201, lng: -123.4181, orderUrl: "https://winston.abbys.com" },
            { name: "Woodburn", address: "1215 N Pacific Hwy, Woodburn, OR 97071", phone: "(503) 981-5494", hours: "11:00 AM - 10:00 PM (Daily)", lat: 45.1551, lng: -122.8681, orderUrl: "https://woodburn.abbys.com" },
            { name: "East Wenatchee", address: "702 Grant Rd, East Wenatchee, WA 98802", phone: "(509) 884-7211", hours: "11:00 AM - 10:00 PM (Daily)", lat: 47.4151, lng: -120.2881, orderUrl: "https://eastwenatchee.abbys.com" },
            { name: "Wenatchee", address: "509 N Western Ave #110, Wenatchee, WA 98801", phone: "(509) 662-2226", hours: "11:00 AM - 10:00 PM (Daily)", lat: 47.4331, lng: -120.3341, orderUrl: "https://wenatchee.abbys.com" },
            { name: "Yakima", address: "4804 Tieton Dr, Yakima, WA 98908", phone: "(509) 966-1398", hours: "11:00 AM - 10:00 PM (Daily)", lat: 46.5961, lng: -120.5731, orderUrl: "https://yakima.abbys.com" }
        ];

        let currentData = [...stores]; 
        
        const storeGrid = document.getElementById('storeGrid');
        const locateBtn = document.getElementById('locateBtn');
        const statusMessage = document.getElementById('statusMessage');
        const searchInput = document.getElementById('searchInput');

        // Haversine formula to calculate distance in miles
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 3958.8; // Radius of the Earth in miles
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
            return R * c;
        }

        // Render the store cards
        function renderStores(storesToRender, closestId = null) {
            storeGrid.innerHTML = '';
            
            if(storesToRender.length === 0) {
                storeGrid.innerHTML = '<p style="text-align:center; grid-column: 1/-1; color: var(--text-light);">No locations found matching your search.</p>';
                return;
            }

            storesToRender.forEach((store) => {
                const isClosest = closestId === store.name;
                
                // Create map URL for directions
                const mapQuery = encodeURIComponent(store.address);
                const mapUrl = `https://maps.google.com/?q=${mapQuery}`;
                
                // Clean phone number for the 'tel:' link (removes parentheses, spaces, and dashes)
                const cleanPhone = store.phone.replace(/\D/g, '');

                const card = document.createElement('div');
                card.className = `store-card ${isClosest ? 'closest' : ''}`;
                
                let distanceHtml = '';
                if (store.distance) {
                    distanceHtml = `<div class="distance">${store.distance.toFixed(1)} miles away</div>`;
                }

                let badgeHtml = isClosest ? `<div class="closest-badge">Closest to you</div>` : '';

                card.innerHTML = `
                    <div>
                        ${badgeHtml}
                        <h2 class="store-name">${store.name}</h2>
                        <p class="store-address">${store.address}</p>
                        <p class="store-phone">üìû <a href="tel:+1${cleanPhone}">${store.phone}</a></p>
                        <p class="store-hours">üïí ${store.hours}</p>
                        ${distanceHtml}
                    </div>
                    <div class="actions">
                        <a href="${store.orderUrl}" target="_blank" class="btn btn-order">Order Now</a>
                        <a href="${mapUrl}" target="_blank" class="btn btn-directions">Directions</a>
                    </div>
                `;
                storeGrid.appendChild(card);
            });
        }

        // Search Filter functionality
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            
            const filteredStores = currentData.filter(store => {
                return store.name.toLowerCase().includes(searchTerm) || 
                       store.address.toLowerCase().includes(searchTerm);
            });
            
            // Re-render, keeping the "closest" highlighted if it's still in the filtered list
            renderStores(filteredStores, currentData[0]?.distance ? currentData[0].name : null);
        });

        // Handle geolocation click
        locateBtn.addEventListener('click', () => {
            if (!navigator.geolocation) {
                statusMessage.textContent = 'Geolocation is not supported by your browser.';
                return;
            }

            locateBtn.textContent = 'Locating...';
            statusMessage.textContent = 'Finding the closest Abby\'s Pizza to you...';

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const userLat = position.coords.latitude;
                    const userLng = position.coords.longitude;

                    // Calculate distance for all stores and update currentData
                    currentData = stores.map(store => {
                        return {
                            ...store,
                            distance: calculateDistance(userLat, userLng, store.lat, store.lng)
                        };
                    });

                    // Sort by closest distance
                    currentData.sort((a, b) => a.distance - b.distance);

                    // Re-render
                    searchInput.value = ''; // clear the search bar if they click GPS
                    renderStores(currentData, currentData[0].name);
                    
                    locateBtn.textContent = 'üìç Find Nearest';
                    statusMessage.textContent = '';
                    
                    // Scroll down slightly so they see the result clearly
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                },
                (error) => {
                    locateBtn.textContent = 'üìç Find Nearest';
                    statusMessage.textContent = 'Unable to retrieve your location. Please check your browser permissions.';
                }
            );
        });

        // Initial render (alphabetical or default order)
        renderStores(currentData);

    </script>
</body>

</html>
